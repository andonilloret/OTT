// Generated by CoffeeScript 1.9.3
(function() {
  var OTTModule, getWhen;

  OTTModule = angular.module('OTTLogin', []);

  getWhen = function(givenDate) {
    var days, monthNames, msInDay, scheduled, time, today;
    monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    scheduled = new Date(givenDate);
    time = ('0' + scheduled.getHours()).slice(-2) + ':' + ('0' + scheduled.getMinutes()).slice(-2);
    scheduled.setHours(0, 0, 0, 0);
    today = (new Date).setHours(0, 0, 0, 0);
    msInDay = 1000 * 60 * 60 * 24;
    days = Math.floor((scheduled - today) / msInDay);
    if (days === 0) {
      return "Hoy " + time;
    }
    if (days === 1) {
      return "Mañana " + time;
    }
    return scheduled.getDate() + ' de ' + monthNames[scheduled.getMonth()] + '\n' + time;
  };

  OTTModule.controller('bodyCtrl', [
    '$scope', '$http', function($scope, $http) {
      schedule.data.forEach(function(event) {
        return event.when = getWhen(event.date_start);
      });
      $scope.schedule = schedule.data;
      return $scope.loginForm = function() {
        var user;
        user = {
          username: $scope.form.email,
          password: $scope.form.password
        };
        $scope.loginIn = true;
        return $http.post('/auth/login', user).then(function(response) {
          if (response.status === 200) {
            return document.location = '/media';
          }
        }, function(response) {
          console.log(response);
          console.log('Usuario o contraseña incorrectos');
          $scope.loginError = true;
          return $scope.loginIn = false;
        });
      };
    }
  ]);

}).call(this);
